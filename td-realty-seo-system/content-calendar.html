<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Calendar - TD Realty SEO System</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .week-card {
      border-left: 4px solid var(--accent-primary);
    }
    .week-card.current {
      border-left-color: var(--success);
      background: var(--success-light);
    }
    .week-card.completed {
      border-left-color: var(--text-muted);
      opacity: 0.7;
    }
    .content-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      border-radius: var(--radius-md);
      margin-bottom: 0.5rem;
      background: var(--bg-tertiary);
    }
    .content-item.blog {
      border-left: 3px solid var(--accent-primary);
    }
    .content-item.neighborhood {
      border-left: 3px solid var(--success);
    }
    .status-selector {
      display: flex;
      gap: 0.25rem;
    }
    .status-btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.7rem;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
      cursor: pointer;
    }
    .status-btn.active {
      background: var(--accent-primary);
      color: white;
      border-color: var(--accent-primary);
    }
    .status-btn.completed {
      background: var(--success);
      border-color: var(--success);
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">TD</div>
        <div>
          <div class="logo-text">Content Calendar</div>
          <div class="logo-subtitle">12-Week Publishing Schedule</div>
        </div>
      </a>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="command-center.html" class="nav-link">Command Center</a>
        <a href="content-calendar.html" class="nav-link active">Calendar</a>
        <a href="citation-tracker.html" class="nav-link">Citations</a>
        <a href="review-tracker.html" class="nav-link">Reviews</a>
        <a href="settings.html" class="nav-link">Settings</a>
      </nav>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
        <span id="theme-icon">&#9790;</span>
      </button>
    </div>
  </header>

  <main class="container">
    <!-- Quick Stats -->
    <section class="card mb-4 fade-in">
      <div class="card-body">
        <div class="grid grid-4">
          <div class="stat-card">
            <div class="stat-value" id="total-content">24</div>
            <div class="stat-label">Total Content Pieces</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="published-count">0</div>
            <div class="stat-label">Published</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="in-progress-count">0</div>
            <div class="stat-label">In Progress</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="current-week">1</div>
            <div class="stat-label">Current Week</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Legend -->
    <div class="flex gap-4 mb-4 flex-wrap">
      <div class="flex items-center gap-2">
        <span style="width: 16px; height: 16px; background: var(--accent-primary); border-radius: 4px;"></span>
        <span class="text-sm">Blog Post</span>
      </div>
      <div class="flex items-center gap-2">
        <span style="width: 16px; height: 16px; background: var(--success); border-radius: 4px;"></span>
        <span class="text-sm">Neighborhood Page</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="badge badge-info">Idea</span>
        <span class="badge badge-warning">Draft</span>
        <span class="badge badge-success">Published</span>
      </div>
    </div>

    <!-- Set Start Date -->
    <section class="card mb-4 fade-in">
      <div class="card-header">
        <h2 class="card-title">&#128197; Calendar Start Date</h2>
      </div>
      <div class="card-body">
        <div class="flex gap-3 items-center flex-wrap">
          <div class="form-group" style="margin-bottom: 0;">
            <label class="form-label">When does Week 1 start?</label>
            <input type="date" class="form-input" id="start-date" style="width: auto;">
          </div>
          <button class="btn btn-primary" onclick="setStartDate()">Update Calendar</button>
          <span class="text-muted text-sm" id="date-info"></span>
        </div>
      </div>
    </section>

    <!-- 12-Week Schedule -->
    <h2 class="mb-3">12-Week Content Schedule</h2>
    <div id="calendar-weeks">
      <!-- Weeks will be injected here -->
    </div>

    <!-- Add Custom Content Modal -->
    <div class="modal-overlay" id="add-content-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Add Custom Content</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Content Type</label>
            <select class="form-select" id="modal-content-type">
              <option value="blog">Blog Post</option>
              <option value="neighborhood">Neighborhood Page</option>
              <option value="comparison">Comparison Post</option>
              <option value="market-update">Market Update</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" id="modal-content-title" placeholder="Enter content title">
          </div>
          <div class="form-group">
            <label class="form-label">Target Keyword</label>
            <input type="text" class="form-input" id="modal-content-keyword" placeholder="Primary keyword to target">
          </div>
          <div class="form-group">
            <label class="form-label">Week</label>
            <select class="form-select" id="modal-content-week">
              <!-- Options injected dynamically -->
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="TDR.Modal.hide('add-content-modal')">Cancel</button>
          <button class="btn btn-primary" onclick="addCustomContent()">Add Content</button>
        </div>
      </div>
    </div>
  </main>

  <script src="js/app.js"></script>
  <script>
    // Default 12-week schedule
    const defaultSchedule = [
      {
        week: 1,
        items: [
          { id: 'w1-1', type: 'blog', title: '1% Commission Realtor Columbus Ohio Guide', keyword: '1% commission realtor Columbus Ohio', status: 'idea', notes: 'Pillar content - comprehensive guide' }
        ]
      },
      {
        week: 2,
        items: [
          { id: 'w2-1', type: 'neighborhood', title: 'Westerville Real Estate - 1% Commission Realtor', keyword: '1% realtor Westerville Ohio', status: 'idea', notes: '' }
        ]
      },
      {
        week: 3,
        items: [
          { id: 'w3-1', type: 'blog', title: 'How to Sell Your House for Less in Columbus', keyword: 'sell house for less Columbus', status: 'idea', notes: '' }
        ]
      },
      {
        week: 4,
        items: [
          { id: 'w4-1', type: 'neighborhood', title: 'Dublin Real Estate - Discount Realtor', keyword: 'discount realtor Dublin Ohio', status: 'idea', notes: '' }
        ]
      },
      {
        week: 5,
        items: [
          { id: 'w5-1', type: 'blog', title: 'TD Realty vs Homes That Click Comparison', keyword: 'homes that click alternative', status: 'idea', notes: 'Competitor comparison' }
        ]
      },
      {
        week: 6,
        items: [
          { id: 'w6-1', type: 'neighborhood', title: 'Powell Real Estate - Low Commission', keyword: 'low commission realtor Powell Ohio', status: 'idea', notes: '' }
        ]
      },
      {
        week: 7,
        items: [
          { id: 'w7-1', type: 'blog', title: 'Columbus Housing Market Update', keyword: 'Columbus Ohio housing market', status: 'idea', notes: 'Monthly market update template' }
        ]
      },
      {
        week: 8,
        items: [
          { id: 'w8-1', type: 'neighborhood', title: 'Gahanna Real Estate - 1% Listing Fee', keyword: '1% listing fee Gahanna', status: 'idea', notes: '' }
        ]
      },
      {
        week: 9,
        items: [
          { id: 'w9-1', type: 'blog', title: 'TD Realty vs Sell for 1 Percent Comparison', keyword: 'sell for 1 percent alternative', status: 'idea', notes: 'Competitor comparison' }
        ]
      },
      {
        week: 10,
        items: [
          { id: 'w10-1', type: 'neighborhood', title: 'New Albany Real Estate - Discount Broker', keyword: 'discount broker New Albany Ohio', status: 'idea', notes: '' }
        ]
      },
      {
        week: 11,
        items: [
          { id: 'w11-1', type: 'blog', title: 'Free Pre-Listing Inspection: Why It Matters', keyword: 'pre-listing inspection benefits', status: 'idea', notes: 'Unique selling proposition content' }
        ]
      },
      {
        week: 12,
        items: [
          { id: 'w12-1', type: 'blog', title: 'First-Time Homebuyer Guide Columbus', keyword: 'first time homebuyer Columbus Ohio', status: 'idea', notes: '1% cashback highlight' }
        ]
      }
    ];

    // State
    let calendarData = null;
    let startDate = null;

    document.addEventListener('DOMContentLoaded', () => {
      loadCalendarData();
      renderCalendar();
      updateStats();
      updateThemeIcon();
      populateWeekSelect();
    });

    function loadCalendarData() {
      calendarData = TDR.DataManager.get('tdr_content_calendar', defaultSchedule);
      startDate = TDR.DataManager.get('tdr_calendar_start', null);

      if (startDate) {
        document.getElementById('start-date').value = startDate;
        updateDateInfo();
      } else {
        // Default to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start-date').value = today;
      }
    }

    function saveCalendarData() {
      TDR.DataManager.set('tdr_content_calendar', calendarData);
    }

    function setStartDate() {
      const dateInput = document.getElementById('start-date').value;
      if (!dateInput) {
        alert('Please select a start date');
        return;
      }
      startDate = dateInput;
      TDR.DataManager.set('tdr_calendar_start', startDate);
      updateDateInfo();
      renderCalendar();
    }

    function updateDateInfo() {
      if (!startDate) return;
      const start = new Date(startDate);
      const end = new Date(start);
      end.setDate(end.getDate() + 84); // 12 weeks
      document.getElementById('date-info').textContent =
        `Schedule: ${TDR.Utils.formatDate(start)} - ${TDR.Utils.formatDate(end)}`;
    }

    function getWeekDates(weekNum) {
      if (!startDate) return { start: null, end: null };
      const start = new Date(startDate);
      start.setDate(start.getDate() + (weekNum - 1) * 7);
      const end = new Date(start);
      end.setDate(end.getDate() + 6);
      return { start, end };
    }

    function getCurrentWeek() {
      if (!startDate) return 1;
      const start = new Date(startDate);
      const now = new Date();
      const diffDays = Math.floor((now - start) / (1000 * 60 * 60 * 24));
      const week = Math.floor(diffDays / 7) + 1;
      return Math.max(1, Math.min(12, week));
    }

    function renderCalendar() {
      const container = document.getElementById('calendar-weeks');
      const currentWeek = getCurrentWeek();
      document.getElementById('current-week').textContent = currentWeek;

      container.innerHTML = calendarData.map(week => {
        const dates = getWeekDates(week.week);
        const isCurrentWeek = week.week === currentWeek;
        const isPastWeek = week.week < currentWeek;
        const allPublished = week.items.every(item => item.status === 'published');

        let weekClass = 'week-card';
        if (isCurrentWeek) weekClass += ' current';
        if (allPublished && isPastWeek) weekClass += ' completed';

        return `
          <div class="card mb-3 ${weekClass}">
            <div class="card-header">
              <div>
                <h3 class="card-title">
                  Week ${week.week}
                  ${isCurrentWeek ? '<span class="badge badge-success ml-2">Current</span>' : ''}
                  ${allPublished ? '<span class="badge badge-info ml-2">Complete</span>' : ''}
                </h3>
                ${dates.start ? `<span class="text-sm text-muted">${TDR.Utils.formatDateShort(dates.start)} - ${TDR.Utils.formatDateShort(dates.end)}</span>` : ''}
              </div>
              <button class="btn btn-sm btn-outline" onclick="addContentToWeek(${week.week})">+ Add Content</button>
            </div>
            <div class="card-body">
              ${week.items.length === 0 ? '<p class="text-muted text-center">No content scheduled</p>' : ''}
              ${week.items.map(item => `
                <div class="content-item ${item.type}">
                  <div style="flex: 1;">
                    <div class="font-medium">${item.title}</div>
                    <div class="text-sm text-muted">
                      <span class="badge ${item.type === 'blog' ? 'badge-info' : 'badge-success'} text-xs">${item.type}</span>
                      ${item.keyword ? `<span class="ml-2">Keyword: ${item.keyword}</span>` : ''}
                    </div>
                    ${item.notes ? `<div class="text-xs text-muted mt-1">${item.notes}</div>` : ''}
                  </div>
                  <div class="status-selector">
                    <button class="status-btn ${item.status === 'idea' ? 'active' : ''}"
                            onclick="updateStatus('${item.id}', 'idea')">Idea</button>
                    <button class="status-btn ${item.status === 'outline' ? 'active' : ''}"
                            onclick="updateStatus('${item.id}', 'outline')">Outline</button>
                    <button class="status-btn ${item.status === 'draft' ? 'active' : ''}"
                            onclick="updateStatus('${item.id}', 'draft')">Draft</button>
                    <button class="status-btn ${item.status === 'edit' ? 'active' : ''}"
                            onclick="updateStatus('${item.id}', 'edit')">Edit</button>
                    <button class="status-btn ${item.status === 'published' ? 'active completed' : ''}"
                            onclick="updateStatus('${item.id}', 'published')">Published</button>
                  </div>
                  <button class="btn btn-sm btn-danger" style="padding: 0.25rem 0.5rem;"
                          onclick="removeContent('${item.id}')" title="Remove">&#10005;</button>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function updateStatus(itemId, newStatus) {
      calendarData.forEach(week => {
        week.items.forEach(item => {
          if (item.id === itemId) {
            item.status = newStatus;
            if (newStatus === 'published') {
              item.publishedDate = new Date().toISOString();
              // Update last content date for alerts
              TDR.DataManager.set(TDR.STORAGE_KEYS.LAST_CONTENT_DATE, new Date().toISOString());
            }
          }
        });
      });
      saveCalendarData();
      renderCalendar();
      updateStats();
    }

    function updateStats() {
      let total = 0;
      let published = 0;
      let inProgress = 0;

      calendarData.forEach(week => {
        week.items.forEach(item => {
          total++;
          if (item.status === 'published') published++;
          if (['outline', 'draft', 'edit'].includes(item.status)) inProgress++;
        });
      });

      document.getElementById('total-content').textContent = total;
      document.getElementById('published-count').textContent = published;
      document.getElementById('in-progress-count').textContent = inProgress;
    }

    function addContentToWeek(weekNum) {
      document.getElementById('modal-content-week').value = weekNum;
      TDR.Modal.show('add-content-modal');
    }

    function populateWeekSelect() {
      const select = document.getElementById('modal-content-week');
      select.innerHTML = '';
      for (let i = 1; i <= 12; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `Week ${i}`;
        select.appendChild(option);
      }
    }

    function addCustomContent() {
      const type = document.getElementById('modal-content-type').value;
      const title = document.getElementById('modal-content-title').value.trim();
      const keyword = document.getElementById('modal-content-keyword').value.trim();
      const weekNum = parseInt(document.getElementById('modal-content-week').value);

      if (!title) {
        alert('Please enter a title');
        return;
      }

      const newItem = {
        id: 'custom-' + TDR.Utils.generateId(),
        type,
        title,
        keyword,
        status: 'idea',
        notes: 'Custom content'
      };

      const week = calendarData.find(w => w.week === weekNum);
      if (week) {
        week.items.push(newItem);
        saveCalendarData();
        renderCalendar();
        updateStats();
        TDR.Modal.hide('add-content-modal');

        // Clear form
        document.getElementById('modal-content-title').value = '';
        document.getElementById('modal-content-keyword').value = '';
      }
    }

    function removeContent(itemId) {
      if (!confirm('Are you sure you want to remove this content?')) return;

      calendarData.forEach(week => {
        week.items = week.items.filter(item => item.id !== itemId);
      });
      saveCalendarData();
      renderCalendar();
      updateStats();
    }

    function toggleTheme() {
      TDR.ThemeManager.toggle();
      updateThemeIcon();
    }

    function updateThemeIcon() {
      document.getElementById('theme-icon').innerHTML = TDR.ThemeManager.isDark() ? '&#9788;' : '&#9790;';
    }
  </script>
</body>
</html>
