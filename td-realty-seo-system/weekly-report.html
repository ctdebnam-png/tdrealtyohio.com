<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Report - TD Realty SEO System</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    @media print {
      body { background: white; }
      .no-print { display: none !important; }
      .card { break-inside: avoid; box-shadow: none; border: 1px solid #ddd; }
    }
  </style>
</head>
<body>
  <header class="header no-print">
    <div class="header-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">TD</div>
        <div>
          <div class="logo-text">Weekly Report</div>
          <div class="logo-subtitle">Progress Summary</div>
        </div>
      </a>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="command-center.html" class="nav-link">Command Center</a>
        <a href="content-calendar.html" class="nav-link">Calendar</a>
        <a href="citation-tracker.html" class="nav-link">Citations</a>
        <a href="review-tracker.html" class="nav-link">Reviews</a>
        <a href="weekly-report.html" class="nav-link active">Report</a>
      </nav>
      <button class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon">&#9790;</span>
      </button>
    </div>
  </header>

  <main class="container">
    <!-- Report Controls -->
    <section class="card mb-4 fade-in no-print">
      <div class="card-header">
        <h2 class="card-title">&#128200; Generate Weekly Report</h2>
        <div class="flex gap-2">
          <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
          <button class="btn btn-secondary" onclick="window.print()">Print / PDF</button>
          <button class="btn btn-outline" onclick="copyReport()">Copy to Clipboard</button>
        </div>
      </div>
      <div class="card-body">
        <div class="grid grid-2">
          <div class="form-group">
            <label class="form-label">Report Week Starting</label>
            <input type="date" class="form-input" id="report-week-start">
          </div>
          <div class="form-group">
            <label class="form-label">Report Week Ending</label>
            <input type="date" class="form-input" id="report-week-end">
          </div>
        </div>
      </div>
    </section>

    <!-- Generated Report -->
    <div id="report-content">
      <!-- Report Header -->
      <section class="card mb-4 fade-in" style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white;">
        <div class="card-body text-center">
          <h1 style="font-size: 1.75rem; margin-bottom: 0.5rem;">TD Realty Ohio - SEO Weekly Report</h1>
          <p id="report-date-range" style="opacity: 0.9;">Week of January 13-19, 2026</p>
        </div>
      </section>

      <!-- Executive Summary -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#128202; Executive Summary</h2>
        </div>
        <div class="card-body">
          <div class="grid grid-4">
            <div class="stat-card">
              <div class="stat-value" id="summary-progress">0%</div>
              <div class="stat-label">Overall Progress</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="summary-completed">0</div>
              <div class="stat-label">Tasks Completed</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="summary-citations">0</div>
              <div class="stat-label">Live Citations</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="summary-reviews">0</div>
              <div class="stat-label">Google Reviews</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Status Alerts -->
      <section class="card mb-4 fade-in" id="alerts-section">
        <div class="card-header">
          <h2 class="card-title">&#9888; Status & Alerts</h2>
        </div>
        <div class="card-body" id="alerts-content">
          <!-- Alerts will be injected here -->
        </div>
      </section>

      <!-- Tasks Completed This Week -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#9989; Completed This Week</h2>
        </div>
        <div class="card-body" id="completed-tasks">
          <p class="text-muted">No tasks completed this week.</p>
        </div>
      </section>

      <!-- Content Published -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#128221; Content Status</h2>
        </div>
        <div class="card-body" id="content-status">
          <p class="text-muted">No content data available.</p>
        </div>
      </section>

      <!-- Category Progress -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#128200; Progress by Category</h2>
        </div>
        <div class="card-body">
          <div id="category-progress">
            <!-- Progress bars will be injected here -->
          </div>
        </div>
      </section>

      <!-- Ranking Changes -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#127919; Keyword Rankings</h2>
        </div>
        <div class="card-body" id="ranking-changes">
          <p class="text-muted">No ranking data available. Start tracking in the Competitor Tracker.</p>
        </div>
      </section>

      <!-- Next Week's Priorities -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#128197; Next Week's Priorities</h2>
        </div>
        <div class="card-body" id="next-priorities">
          <p class="text-muted">Loading...</p>
        </div>
      </section>

      <!-- Recommendations -->
      <section class="card mb-4 fade-in">
        <div class="card-header">
          <h2 class="card-title">&#128161; Recommendations</h2>
        </div>
        <div class="card-body" id="recommendations">
          <p class="text-muted">Loading...</p>
        </div>
      </section>

      <!-- Report Footer -->
      <section class="card fade-in" style="background: var(--bg-tertiary);">
        <div class="card-body text-center">
          <p class="text-sm text-muted">
            Generated by TD Realty SEO System<br>
            Report Date: <span id="report-generated-date"></span>
          </p>
        </div>
      </section>
    </div>
  </main>

  <script src="js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setDefaultDates();
      generateReport();
      document.getElementById('theme-icon').innerHTML = TDR.ThemeManager.isDark() ? '&#9788;' : '&#9790;';
    });

    function setDefaultDates() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const monday = new Date(today);
      monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);

      document.getElementById('report-week-start').value = monday.toISOString().split('T')[0];
      document.getElementById('report-week-end').value = sunday.toISOString().split('T')[0];
    }

    function generateReport() {
      const startDate = document.getElementById('report-week-start').value;
      const endDate = document.getElementById('report-week-end').value;

      // Update date range display
      const start = new Date(startDate);
      const end = new Date(endDate);
      document.getElementById('report-date-range').textContent =
        `Week of ${start.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;

      // Get all data
      const progress = TDR.TaskManager.getProgress();
      const tasks = TDR.TaskManager.getTasks();
      const citations = TDR.DataManager.get(TDR.STORAGE_KEYS.CITATIONS, []);
      const reviews = TDR.DataManager.get(TDR.STORAGE_KEYS.REVIEWS, []);
      const rankings = TDR.DataManager.get(TDR.STORAGE_KEYS.RANKINGS, []);
      const contentCalendar = TDR.DataManager.get('tdr_content_calendar', []);
      const googleReviews = TDR.DataManager.get('tdr_google_reviews', 0);

      // Executive Summary
      document.getElementById('summary-progress').textContent = progress.percentage + '%';
      document.getElementById('summary-completed').textContent = progress.completedThisWeek;
      document.getElementById('summary-citations').textContent = citations.filter(c => c.status === 'live').length;
      document.getElementById('summary-reviews').textContent = googleReviews;

      // Alerts
      const alerts = TDR.AlertSystem.getAlerts();
      const alertsContent = document.getElementById('alerts-content');
      if (alerts.length === 0) {
        alertsContent.innerHTML = `
          <div class="alert alert-success">
            <span class="alert-icon">&#10003;</span>
            <div class="alert-content">
              <strong>All systems green!</strong> No urgent issues this week.
            </div>
          </div>
        `;
      } else {
        alertsContent.innerHTML = alerts.map(alert => `
          <div class="alert alert-${alert.type}">
            <span class="alert-icon">${alert.type === 'danger' ? '&#9888;' : '&#9432;'}</span>
            <div class="alert-content">
              <strong>${alert.title}</strong>: ${alert.message}
            </div>
          </div>
        `).join('');
      }

      // Completed Tasks This Week
      const completedTasks = document.getElementById('completed-tasks');
      const weekCompletedTasks = [];
      const startTimestamp = new Date(startDate).getTime();
      const endTimestamp = new Date(endDate).getTime() + 86400000; // Include end day

      Object.entries(tasks).forEach(([category, categoryTasks]) => {
        categoryTasks.forEach(task => {
          if (task.completed && task.completedDate) {
            const taskDate = new Date(task.completedDate).getTime();
            if (taskDate >= startTimestamp && taskDate <= endTimestamp) {
              weekCompletedTasks.push({ ...task, category });
            }
          }
        });
      });

      if (weekCompletedTasks.length > 0) {
        completedTasks.innerHTML = `
          <ul>
            ${weekCompletedTasks.map(t => `
              <li class="mb-2">
                <span class="badge badge-success text-xs">${t.category}</span>
                ${t.text}
              </li>
            `).join('')}
          </ul>
        `;
      } else {
        completedTasks.innerHTML = '<p class="text-muted">No tasks completed this week. Time to get moving!</p>';
      }

      // Content Status
      const contentStatus = document.getElementById('content-status');
      const publishedContent = [];
      const lastContentDate = TDR.DataManager.get(TDR.STORAGE_KEYS.LAST_CONTENT_DATE);
      const daysSinceContent = lastContentDate ? TDR.Utils.daysSince(lastContentDate) : null;

      contentCalendar.forEach(week => {
        week.items.forEach(item => {
          if (item.status === 'published' && item.publishedDate) {
            const pubDate = new Date(item.publishedDate).getTime();
            if (pubDate >= startTimestamp && pubDate <= endTimestamp) {
              publishedContent.push(item);
            }
          }
        });
      });

      contentStatus.innerHTML = `
        <div class="grid grid-2">
          <div>
            <h4 class="font-medium mb-2">Published This Week</h4>
            ${publishedContent.length > 0
              ? `<ul>${publishedContent.map(c => `<li>${c.title}</li>`).join('')}</ul>`
              : '<p class="text-muted">No content published this week</p>'}
          </div>
          <div>
            <h4 class="font-medium mb-2">Content Metrics</h4>
            <p>Days since last publish: <strong ${daysSinceContent > 7 ? 'style="color: var(--danger);"' : ''}>${daysSinceContent !== null ? daysSinceContent : 'N/A'}</strong></p>
            <p>Total published: <strong>${contentCalendar.reduce((sum, w) => sum + w.items.filter(i => i.status === 'published').length, 0)}</strong></p>
          </div>
        </div>
      `;

      // Category Progress
      const categoryProgress = document.getElementById('category-progress');
      const categories = [
        { key: 'technical', label: 'Technical SEO' },
        { key: 'citations', label: 'Citations' },
        { key: 'content', label: 'Content Creation' },
        { key: 'neighborhoods', label: 'Neighborhood Pages' },
        { key: 'reviews', label: 'Reviews & Social Proof' },
        { key: 'backlinks', label: 'Backlink Building' }
      ];

      categoryProgress.innerHTML = categories.map(cat => {
        const catProgress = TDR.TaskManager.getCategoryProgress(cat.key);
        return `
          <div class="mb-3">
            <div class="flex justify-between text-sm mb-1">
              <span>${cat.label}</span>
              <span>${catProgress.completed}/${catProgress.total} (${catProgress.percentage}%)</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill ${catProgress.percentage >= 75 ? 'success' : catProgress.percentage >= 50 ? '' : 'warning'}"
                   style="width: ${catProgress.percentage}%"></div>
            </div>
          </div>
        `;
      }).join('');

      // Ranking Changes
      const rankingChanges = document.getElementById('ranking-changes');
      const recentRankings = rankings
        .filter(r => {
          const rDate = new Date(r.date).getTime();
          return rDate >= startTimestamp && rDate <= endTimestamp && r.rankings.tdrealty;
        })
        .sort((a, b) => new Date(b.date) - new Date(a.date));

      if (recentRankings.length > 0) {
        rankingChanges.innerHTML = `
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Keyword</th>
                  <th>Current Rank</th>
                  <th>Change</th>
                </tr>
              </thead>
              <tbody>
                ${recentRankings.slice(0, 8).map(r => `
                  <tr>
                    <td class="text-sm">${r.keyword}</td>
                    <td>#${r.rankings.tdrealty}</td>
                    <td>-</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      }

      // Next Week's Priorities
      const priorities = TDR.TaskManager.getWeeklyPriorities();
      const nextPriorities = document.getElementById('next-priorities');

      if (priorities.length > 0) {
        nextPriorities.innerHTML = `
          <ol>
            ${priorities.map(p => `<li class="mb-2">${p.text}</li>`).join('')}
          </ol>
        `;
      } else {
        nextPriorities.innerHTML = '<p class="text-success">All priority tasks completed! Review and add new goals.</p>';
      }

      // Recommendations
      const recommendations = document.getElementById('recommendations');
      const recs = [];

      if (googleReviews < 10) {
        recs.push('Focus on getting more Google reviews. Send review request emails to recent clients.');
      }
      if (citations.filter(c => c.status === 'live').length < 10) {
        recs.push('Submit to more directories. Aim for at least 15 live citations.');
      }
      if (daysSinceContent > 7) {
        recs.push('Publish new content this week. Follow the content calendar schedule.');
      }
      if (progress.percentage < 50) {
        recs.push('Complete more technical SEO tasks to build a strong foundation.');
      }
      if (recs.length === 0) {
        recs.push('Great progress! Keep up the consistent effort.');
        recs.push('Consider starting on advanced SEO strategies like link building.');
      }

      recommendations.innerHTML = `
        <ul>
          ${recs.map(r => `<li class="mb-2">${r}</li>`).join('')}
        </ul>
      `;

      // Generated date
      document.getElementById('report-generated-date').textContent = new Date().toLocaleString();
    }

    function copyReport() {
      const report = document.getElementById('report-content');
      const text = report.innerText;
      navigator.clipboard.writeText(text).then(() => {
        alert('Report copied to clipboard!');
      });
    }

    function toggleTheme() {
      TDR.ThemeManager.toggle();
      document.getElementById('theme-icon').innerHTML = TDR.ThemeManager.isDark() ? '&#9788;' : '&#9790;';
    }
  </script>
</body>
</html>
