<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO Command Center - TD Realty SEO System</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">TD</div>
        <div>
          <div class="logo-text">SEO Command Center</div>
          <div class="logo-subtitle">Task Tracker & Alerts</div>
        </div>
      </a>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="command-center.html" class="nav-link active">Command Center</a>
        <a href="content-calendar.html" class="nav-link">Calendar</a>
        <a href="citation-tracker.html" class="nav-link">Citations</a>
        <a href="review-tracker.html" class="nav-link">Reviews</a>
        <a href="settings.html" class="nav-link">Settings</a>
      </nav>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
        <span id="theme-icon">&#9790;</span>
      </button>
    </div>
  </header>

  <main class="container">
    <!-- Alerts Section -->
    <section id="alerts-section" class="mb-4 fade-in">
      <!-- Alerts will be injected here -->
    </section>

    <!-- Progress Overview -->
    <section class="card mb-4 fade-in">
      <div class="card-header">
        <h2 class="card-title">&#128202; Progress Overview</h2>
        <div class="flex gap-2">
          <button class="btn btn-sm btn-outline" onclick="resetAllTasks()">Reset All</button>
          <button class="btn btn-sm btn-primary" onclick="exportTasks()">Export Data</button>
        </div>
      </div>
      <div class="card-body">
        <div class="grid grid-3">
          <div class="stat-card">
            <div class="stat-value" id="overall-percentage">0%</div>
            <div class="stat-label">Overall Completion</div>
            <div class="progress-bar mt-3" style="height: 10px;">
              <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="total-completed">0/0</div>
            <div class="stat-label">Tasks Completed</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="this-week-count">0</div>
            <div class="stat-label">Completed This Week</div>
          </div>
        </div>

        <!-- Category Progress Bars -->
        <div class="mt-4">
          <h3 class="text-sm font-medium mb-3">Progress by Category</h3>
          <div class="grid grid-2" style="gap: 1rem;">
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Technical SEO</span>
                <span id="tech-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="tech-progress"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Citations</span>
                <span id="cite-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="cite-progress"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Content</span>
                <span id="content-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="content-progress"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Neighborhoods</span>
                <span id="hood-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="hood-progress"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Reviews</span>
                <span id="review-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="review-progress"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-sm mb-1">
                <span>Backlinks</span>
                <span id="link-progress-text">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="link-progress"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Weekly Action Items -->
    <section class="card mb-4 fade-in">
      <div class="card-header">
        <h2 class="card-title">&#127919; Weekly Action Items</h2>
        <span class="badge badge-info" id="priority-count">0 items</span>
      </div>
      <div class="card-body" id="weekly-priorities">
        <p class="text-muted">Loading priorities...</p>
      </div>
    </section>

    <!-- Manual Metrics Input -->
    <section class="card mb-4 fade-in">
      <div class="card-header">
        <h2 class="card-title">&#128200; Manual Metrics</h2>
        <span class="text-muted text-sm">Update these weekly</span>
      </div>
      <div class="card-body">
        <div class="grid grid-4">
          <div class="form-group">
            <label class="form-label">Google Reviews</label>
            <input type="number" class="form-input" id="google-reviews" min="0" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">Domain Authority (est.)</label>
            <input type="number" class="form-input" id="domain-authority" min="0" max="100" placeholder="0">
          </div>
          <div class="form-group">
            <label class="form-label">Last Content Published</label>
            <input type="date" class="form-input" id="last-content-date">
          </div>
          <div class="form-group">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-primary" style="width: 100%;" onclick="saveManualMetrics()">Save Metrics</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Task Checklists -->
    <div class="tabs">
      <button class="tab active" onclick="showCategory('technical')">Technical SEO</button>
      <button class="tab" onclick="showCategory('citations')">Citations</button>
      <button class="tab" onclick="showCategory('content')">Content</button>
      <button class="tab" onclick="showCategory('neighborhoods')">Neighborhoods</button>
      <button class="tab" onclick="showCategory('reviews')">Reviews</button>
      <button class="tab" onclick="showCategory('backlinks')">Backlinks</button>
    </div>

    <!-- Technical SEO Tasks -->
    <section class="card mb-4 fade-in task-category" id="technical-section">
      <div class="card-header">
        <h2 class="card-title">&#9881; Technical SEO Tasks</h2>
        <span class="badge badge-info" id="technical-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="technical-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> Technical SEO is the foundation. Without proper indexing, schema, and site speed, other efforts won't rank.
        </p>
      </div>
    </section>

    <!-- Citations Tasks -->
    <section class="card mb-4 fade-in task-category" id="citations-section" style="display: none;">
      <div class="card-header">
        <h2 class="card-title">&#128205; Citation/Directory Submissions</h2>
        <span class="badge badge-info" id="citations-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="citations-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> Citations build local SEO authority. Consistent NAP (Name, Address, Phone) across 15+ directories significantly boosts local rankings.
        </p>
      </div>
    </section>

    <!-- Content Tasks -->
    <section class="card mb-4 fade-in task-category" id="content-section" style="display: none;">
      <div class="card-header">
        <h2 class="card-title">&#9997; Content Creation</h2>
        <span class="badge badge-info" id="content-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="content-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> Blog content targets long-tail keywords and establishes expertise. Each post is a new opportunity to rank and capture leads.
        </p>
      </div>
    </section>

    <!-- Neighborhoods Tasks -->
    <section class="card mb-4 fade-in task-category" id="neighborhoods-section" style="display: none;">
      <div class="card-header">
        <h2 class="card-title">&#127968; Neighborhood Pages</h2>
        <span class="badge badge-info" id="neighborhoods-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="neighborhoods-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> City-specific pages rank for "[city] realtor" searches. Each page targets a different local market.
        </p>
      </div>
    </section>

    <!-- Reviews Tasks -->
    <section class="card mb-4 fade-in task-category" id="reviews-section" style="display: none;">
      <div class="card-header">
        <h2 class="card-title">&#11088; Reviews & Social Proof</h2>
        <span class="badge badge-info" id="reviews-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="reviews-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> Google reviews are a major ranking factor for local searches. More reviews = more trust = higher rankings.
        </p>
      </div>
    </section>

    <!-- Backlinks Tasks -->
    <section class="card mb-4 fade-in task-category" id="backlinks-section" style="display: none;">
      <div class="card-header">
        <h2 class="card-title">&#128279; Backlink Building</h2>
        <span class="badge badge-info" id="backlinks-count">0/0</span>
      </div>
      <div class="card-body">
        <div class="checkbox-group" id="backlinks-tasks">
          <!-- Tasks injected here -->
        </div>
      </div>
      <div class="card-footer">
        <p class="text-sm text-muted">
          <strong>Why it matters:</strong> Quality backlinks signal authority to Google. Local and industry-relevant links are most valuable for real estate SEO.
        </p>
      </div>
    </section>
  </main>

  <script src="js/app.js"></script>
  <script>
    let currentCategory = 'technical';

    document.addEventListener('DOMContentLoaded', () => {
      loadAllTasks();
      updateProgressMetrics();
      updateAlerts();
      updateWeeklyPriorities();
      loadManualMetrics();
      updateThemeIcon();
    });

    function loadAllTasks() {
      const categories = ['technical', 'citations', 'content', 'neighborhoods', 'reviews', 'backlinks'];
      categories.forEach(category => {
        loadCategoryTasks(category);
      });
    }

    function loadCategoryTasks(category) {
      const tasks = TDR.TaskManager.getTasks();
      const categoryTasks = tasks[category] || [];
      const container = document.getElementById(`${category}-tasks`);
      const countEl = document.getElementById(`${category}-count`);

      const completed = categoryTasks.filter(t => t.completed).length;
      countEl.textContent = `${completed}/${categoryTasks.length}`;

      container.innerHTML = categoryTasks.map(task => `
        <label class="checkbox-item ${task.completed ? 'completed' : ''}">
          <input type="checkbox" class="checkbox-input"
                 ${task.completed ? 'checked' : ''}
                 onchange="toggleTask('${category}', '${task.id}')">
          <span class="checkbox-label">${task.text}</span>
          ${task.completedDate ? `<span class="text-xs text-muted">${TDR.Utils.formatDateShort(task.completedDate)}</span>` : ''}
        </label>
      `).join('');
    }

    function toggleTask(category, taskId) {
      TDR.TaskManager.toggleTask(category, taskId);
      loadCategoryTasks(category);
      updateProgressMetrics();
      updateAlerts();
      updateWeeklyPriorities();
    }

    function showCategory(category) {
      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Show/hide sections
      document.querySelectorAll('.task-category').forEach(section => {
        section.style.display = 'none';
      });
      document.getElementById(`${category}-section`).style.display = 'block';

      currentCategory = category;
    }

    function updateProgressMetrics() {
      const progress = TDR.TaskManager.getProgress();

      // Overall metrics
      document.getElementById('overall-percentage').textContent = progress.percentage + '%';
      document.getElementById('overall-progress-bar').style.width = progress.percentage + '%';
      document.getElementById('total-completed').textContent = `${progress.completed}/${progress.total}`;
      document.getElementById('this-week-count').textContent = progress.completedThisWeek;

      // Category progress bars
      const categories = [
        { key: 'technical', prefix: 'tech' },
        { key: 'citations', prefix: 'cite' },
        { key: 'content', prefix: 'content' },
        { key: 'neighborhoods', prefix: 'hood' },
        { key: 'reviews', prefix: 'review' },
        { key: 'backlinks', prefix: 'link' }
      ];

      categories.forEach(cat => {
        const catProgress = TDR.TaskManager.getCategoryProgress(cat.key);
        document.getElementById(`${cat.prefix}-progress`).style.width = catProgress.percentage + '%';
        document.getElementById(`${cat.prefix}-progress-text`).textContent = catProgress.percentage + '%';
      });
    }

    function updateAlerts() {
      const alerts = TDR.AlertSystem.getAlerts();
      const container = document.getElementById('alerts-section');

      if (alerts.length === 0) {
        container.innerHTML = `
          <div class="alert alert-success">
            <span class="alert-icon">&#10003;</span>
            <div class="alert-content">
              <div class="alert-title">All Systems Go!</div>
              <p>You're on track. Keep up the momentum!</p>
            </div>
          </div>
        `;
      } else {
        container.innerHTML = alerts.map(alert => `
          <div class="alert alert-${alert.type}">
            <span class="alert-icon">${alert.type === 'danger' ? '&#9888;' : '&#9432;'}</span>
            <div class="alert-content">
              <div class="alert-title">${alert.title}</div>
              <p>${alert.message}</p>
            </div>
          </div>
        `).join('');
      }
    }

    function updateWeeklyPriorities() {
      const priorities = TDR.TaskManager.getWeeklyPriorities();
      const container = document.getElementById('weekly-priorities');
      const countEl = document.getElementById('priority-count');

      countEl.textContent = `${priorities.length} items`;

      if (priorities.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding: 2rem;">
            <div class="empty-state-icon">&#127881;</div>
            <div class="empty-state-title">Amazing!</div>
            <p>All priority tasks completed. Time to set new goals!</p>
          </div>
        `;
        return;
      }

      const categoryLabels = {
        technical: 'Technical',
        citations: 'Citation',
        content: 'Content',
        neighborhoods: 'Neighborhood',
        reviews: 'Reviews',
        backlinks: 'Backlinks'
      };

      container.innerHTML = `
        <div class="checkbox-group">
          ${priorities.map((task, i) => `
            <div class="checkbox-item" style="background: var(--bg-tertiary);">
              <span style="font-weight: bold; color: var(--accent-primary); min-width: 28px; font-size: 1.1rem;">${i + 1}.</span>
              <div style="flex: 1;">
                <div class="checkbox-label" style="font-weight: 500;">${task.text}</div>
                <span class="badge badge-info text-xs mt-1">${categoryLabels[task.category]}</span>
              </div>
              <button class="btn btn-sm btn-outline" onclick="jumpToTask('${task.category}', '${task.id}')">
                Go to Task
              </button>
            </div>
          `).join('')}
        </div>
      `;
    }

    function jumpToTask(category, taskId) {
      // Show the category
      document.querySelectorAll('.tab').forEach((tab, i) => {
        const categories = ['technical', 'citations', 'content', 'neighborhoods', 'reviews', 'backlinks'];
        if (categories[i] === category) {
          tab.click();
        }
      });

      // Scroll to section
      setTimeout(() => {
        document.getElementById(`${category}-section`).scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }

    function loadManualMetrics() {
      const reviews = TDR.DataManager.get('tdr_google_reviews', '');
      const da = TDR.DataManager.get('tdr_domain_authority', '');
      const lastContent = TDR.DataManager.get(TDR.STORAGE_KEYS.LAST_CONTENT_DATE, '');

      document.getElementById('google-reviews').value = reviews;
      document.getElementById('domain-authority').value = da;
      document.getElementById('last-content-date').value = lastContent ? lastContent.split('T')[0] : '';
    }

    function saveManualMetrics() {
      const reviews = parseInt(document.getElementById('google-reviews').value) || 0;
      const da = parseInt(document.getElementById('domain-authority').value) || 0;
      const lastContent = document.getElementById('last-content-date').value;

      TDR.DataManager.set('tdr_google_reviews', reviews);
      TDR.DataManager.set('tdr_domain_authority', da);
      if (lastContent) {
        TDR.DataManager.set(TDR.STORAGE_KEYS.LAST_CONTENT_DATE, new Date(lastContent).toISOString());
      }

      updateAlerts();
      alert('Metrics saved successfully!');
    }

    function resetAllTasks() {
      if (confirm('Are you sure you want to reset ALL tasks? This cannot be undone.')) {
        TDR.DataManager.remove(TDR.STORAGE_KEYS.TASKS);
        loadAllTasks();
        updateProgressMetrics();
        updateWeeklyPriorities();
        alert('All tasks have been reset.');
      }
    }

    function exportTasks() {
      const data = {
        tasks: TDR.TaskManager.getTasks(),
        progress: TDR.TaskManager.getProgress(),
        exportDate: new Date().toISOString(),
        metrics: {
          googleReviews: TDR.DataManager.get('tdr_google_reviews', 0),
          domainAuthority: TDR.DataManager.get('tdr_domain_authority', 0),
          lastContentDate: TDR.DataManager.get(TDR.STORAGE_KEYS.LAST_CONTENT_DATE, null)
        }
      };

      TDR.ExportManager.download(
        TDR.ExportManager.toJSON(data),
        `td-realty-seo-tasks-${new Date().toISOString().split('T')[0]}.json`
      );
    }

    function toggleTheme() {
      TDR.ThemeManager.toggle();
      updateThemeIcon();
    }

    function updateThemeIcon() {
      document.getElementById('theme-icon').innerHTML = TDR.ThemeManager.isDark() ? '&#9788;' : '&#9790;';
    }
  </script>
</body>
</html>
